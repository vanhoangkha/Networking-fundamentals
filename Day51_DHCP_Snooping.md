# NGÀY 51: DHCP SNOOPING

# 50. DHCP SNOOPING (LAYER 2) là gì DHCP Snooping? - DHCP Snooping là Bảo mật feature của SWITCHES that là used đến filter DHCP messages received trên UNTRUSTED PORTS - DHCP Snooping only filters DHCP MESSAGES. - Non-DHCP MESSAGES là not affected - All PORTS là UNTRUSTED, by Default - Usually UPLINK PORTS là configured as TRUSTED PORTS, and DOWNLINK PORTS remain UNTRUSTED! [image](https: //github. com/psaumur/CCNA/assets/106411237/9ed71d09-d94c-4fc9-ad87-1b31acfdd132)! [image](https: //github. com/psaumur/CCNA/assets/106411237/9d7d23a6-9d54-4234-a07e-a5caea136c94) --- ATTACKS trên DHCP DHCP STARVATION - An example của một DHCP-based ATTACK là DHCP STARVATION ATTACK - An ATTACKER uses spoofed MAC ADDRESSES đến flood DHCP DISCOVER messages - The TARGET server’s DHCP POOL becomes full. resulting trong một DoS đến other DEVICES! [image](https: //github. com/psaumur/CCNA/assets/106411237/33dfbb8b-2b78-4700-b4ab-0dd95fc03eed) DHCP POISONING (MAN-in-the-Middle) - Similar đến ARP POISONING. DHCP POISONING có thể be used đến perform một MAN-in-the-Middle ATTACK - A *spurious DHCP SERVER* replies đến CLIENTS’ DHCP Discover messages và assigns them IP ADDRESSES but makes the CLIENTS use the *spurious SERVER’S IP* as một Gateway mặc định ** CLIENTS usually accept the first DHCP OFFER message they receive - This sẽ cause the CLIENT đến send TRAFFIC đến the ATTACKER instead của the legitimate Gateway mặc định - The ATTACKER có thể then examine / modify the TRAFFIC before forwarding it đến the legitimate Gateway mặc định! [image](https: //github. com/psaumur/CCNA/assets/106411237/d0cd7a5c-9ff4-4ab7-bec6-4edec4ea2646)! [image](https: //github. com/psaumur/CCNA/assets/106411237/1573bcb7-6fa8-46d7-8cb8-46e30bac559d) --- DHCP MESSAGES - When DHCP Snooping filters messages. it differentiates between DHCP SERVER messages và DHCP CLIENT messages - Messages sent bởi DHCP SERVERS: - OFFER - ACK - NAK = Opposite của ACK - used đến DECLINE một CLIENT’S REQUEST - Messages sent bởi DHCP CLIENTS: - DISCOVER - REQUEST - RELEASE = Used đến tell the SERVER that the CLIENT no longer needs its Địa chỉ IP - DECLINE = Used đến DECLINE the Địa chỉ IP offered bởi một DHCP SERVER --- HOW DOES IT WORK? - If một DHCP MESSAGE là received trên một TRUSTED Cổng, forward it as normal without inspection - If một DHCP MESSAGE là received trên một UNTRUSTED Cổng. inspect it và act as follows: - If it là DHCP SERVER message, discard it - If it as một DHCP CLIENT message, perform the following checks: - DISCOVER / REQUEST messages: - Check if the Khung’S SOURCE Địa chỉ MAC và the DHCP MESSAGE’S CHADDR FIELDS match. - MATCH = FORWARD - MISMATCH = DISCARD - RELEASE / DECLINE messages: - Check if the Gói tin’S SOURCE Địa chỉ IP và the receiving Giao diện match the entry trong the *DHCP Snooping BINDING TABLE* - MATCH = FORWARD - MISMATCH = DISCARD - When một CLIENT successfully leases một Địa chỉ IP từ một SERVER. create một new entry trong the *DHCP Snooping BINDING TABLE* --- DHCP Snooping Cấu hình! [image](https: //github. com/psaumur/CCNA/assets/106411237/729466dc-9432-47d2-8799-652fa064b058) switch 2’s Cấu hình! [image](https: //github. com/psaumur/CCNA/assets/106411237/8d6cacb8-ffd8-4cf0-bd96-fe9978377989) switch 1’s Cấu hình! [image](https: //github. com/psaumur/CCNA/assets/106411237/bb11e4fd-a340-4dd3-a6f5-3cd280fc5a13) DHCP Snooping RATE-LIMITING - DHCP Snooping có thể limit the RATE tại which DHCP messages là allowed đến enter một Giao diện - If the RATE của DHCP messages crosses the configured LIMIT, the Giao diện là `err-disabled` - Like với Cổng Bảo mật. the Giao diện có thể be manually re-enabled, or automatically re-enabled với `errdisable recovery`! [image](https: //github. com/psaumur/CCNA/assets/106411237/6586df19-5a58-4ca3-a316-bd0aeb2ce67c) - You wouldn’t set the limit rate đến 1 since it’s so low. it sẽ shut the Cổng immediately but this shows how RATE-LIMITING works `errdisable recovery cause DHCP-rate-limit`! [image](https: //github. com/psaumur/CCNA/assets/106411237/83c324aa-baa0-4ae1-82ac-157e503e048a) DHCP OPTION 82 (INFORMATION OPTION) - OPTION 82, also known as a ‘DHCP RELAY AGENT INFOMRATION OPTION’ is one của MANY DHCP OPTIONS - It provides additional information about which DHCP RELAY AGENT received the CLIENT’S message. on which Giao diện, in which VLAN, etc. - DHCP RELAY AGENTS có thể add OPTION 82 đến message they forward đến the remote DHCP SERVER - With DHCP Snooping enabled, by Default Cisco SWITCHES sẽ add OPTION 82 đến DHCP messages they receive từ CLIENTS. even if the switch isn’t acting as một DHCP RELAY AGENT - By Default, Cisco SWITCHES sẽ drop DHCP MESSAGES với OPTION 82 that là received trên một UNTRUSTED Cổng! [image](https: //github. com/psaumur/CCNA/assets/106411237/2efc6edd-21fd-4c1a-bb11-9c1f761e1d32) THIS Lệnh disables OPTION 82 cho SW1 but NOT SW2! [image](https: //github. com/psaumur/CCNA/assets/106411237/84f1c3f2-9ad1-4367-97f3-95dab053b30c) TRAFFIC gets passed đến R1 và là DROPPED because of “inconsistent relay information” (Gói tin contains OPTION 82 but wasn’t dropped bởi SW2)! [image](https: //github. com/psaumur/CCNA/assets/106411237/5c4b547e-c588-4d62-8098-76902199a131) By ENABLING OPTION 82 trên both SWITCHES…! [image](https: //github. com/psaumur/CCNA/assets/106411237/dda50cf6-ae86-47ec-9b4f-104669697f64) PC1’s DHCP DISCOVER message gets passed, through SW1 và SW2, to R1. R1 responds với một DHCP OFFER message, as normal! [image](https: //github. com/psaumur/CCNA/assets/106411237/7e59cc5a-bf8e-482d-848d-5bfa0540c74b) --- Lệnh SUMMARY! [image](https: //github. com/psaumur/CCNA/assets/106411237/308e32fa-52bd-4ee4-9356-f14e65416e17)