# 47. QoS (CHẤT LƯỢNG DỊCH VỤ) : PART 2 Phân loại / Đánh dấu - Mục đích của QoS là đến give certain kinds của Mạng TRAFFIC priority over other during congestion - Phân loại organizes Mạng TRAFFIC (PACKETS) into TRAFFIC CLASSES (CATEGORIES) - Phân loại là fundamental đến QoS. - To give PRIORITY đến certain types của TRAFFIC, you have đến IDENTIFY which types của TRAFFIC đến give PRIORITY to. - There là MANY methods của CLASSIFYING TRAFFIC - An ACL : TRAFFIC which là permitted bởi the ACL sẽ be given certain TREATMENT, other TRAFFIC sẽ not - NBAR (Mạng Based Application Recognition) performs a *DEEP Gói tin INSPECTION,* looking beyond the LAYER 3 và LAYER 4 information up đến LAYER 7 đến identify the specific kinds của TRAFFIC - In the LAYER 2 và LAYER 3 HEADERS there là specific FIELDS used cho this purpose - The PCP (PRIORITY CODE POINT) FIELD của the 802.1Q Tag (in the Ethernet Header) can be used đến identify HIGH / LOW PRIORITY TRAFFIC - ** ONLY when there là một dot1q tag! - The DSCP (DIFFERENTIATED SERVICES CODE POINT) FIELD của the IP Header có thể also be used đến identify HIGH / LOW PRIORITY TRAFFIC --- PCP / CoS ![image](https://github.com/psaumur/CCNA/assets/106411237/2d2037b6-6992-4758-a1cb-5df0f939b153) - PCP là also known as CoS (CLASS của SERVICE) - It’s use là defined bởi IEEE 802.1p - 3 bits = 8 possible values (2^3 = 8) ![image](https://github.com/psaumur/CCNA/assets/106411237/af191e31-082d-43c0-ab76-225d4dd2e354) - PCP VALUE 0: - “BEST EFFORT” DELIVERY means there là no guarantee that data là delivered hoặc that it meets ANY QoS Standard. This là REGULAR TRAFFIC - NOT HIGH PRIORITY - PCP VALUE 3 và 5: - IP PHONES MARK call signaling TRAFFIC (used đến establish calls) as PCP3 - They MARK the actual VOICE TRAFFIC as PCP5 - Because PCP là found trong the dot1q Header, it có thể only be used over the following connections: - Trunk LINKS - Truy cập LINKS với một VLAN thoại - In the diagram below, TRAFFIC between R1 và R2, or between R2 và EXTERNAL DESTINATIONS sẽ not have một dot1q tag. So, traffic over those links PCP cannot be marked với một PCP value. ![image](https://github.com/psaumur/CCNA/assets/106411237/07a1cbb3-d034-4a9b-accc-59e7f738452f) --- THE IP ToS BYTE ![image](https://github.com/psaumur/CCNA/assets/106411237/3323ff23-96a5-45f4-abde-893d72a4021f) ![image](https://github.com/psaumur/CCNA/assets/106411237/ffec398b-7b0a-47a1-9758-a7a14daf6aa0) (6 bits cho DSCP và 2 bits cho ECN) --- IP PRECEDENCE (OLD) ![image](https://github.com/psaumur/CCNA/assets/106411237/1b0ca3ca-fc8d-4225-9368-64c8ff9587da) - Standard IPP markings là similar đến PCP: - 6 và 7 là reserved to ‘Mạng Kiểm soát traffic’ (ie: OSPF Messages between ROUTERS) - 5 = VOICE - 4 = VIDEO - 3 = VOICE SIGNALLING - 0 = BEST EFFORT - With 6 và 7 reserved, 6 possible values remain - Although 6 values là sufficient cho many NETWORKS, the QoS REQUIREMENTS của some NETWORKS demand more flexibility --- DSCP (CURRENT) ![image](https://github.com/psaumur/CCNA/assets/106411237/48a63948-81b9-43d5-a108-34525a381533) - RFC 2474 (1998) defines the DSCP field, and other ‘DiffServ’ RFCs elaborate trên its use - With IPP updated đến DSCP, new STANDARD MARKINGS had đến be decided on - By having generally agreed upon STANDARD MARKINGS cho DIFFERENT KINDS của TRAFFIC: - QoS DESIGN và IMPLEMENTATION là simplified. - QoS works better between ISPs và ENTERPRISES - etc. - You nên be AWARE của the FOLLOWING STANDARD MARKINGS: - Default FORWARDING (DF) - Best Effort TRAFFIC - EXPEDITED FORWARDING (EF) - Low Loss / Latency / Jitter TRAFFIC (usually voice) - ASSURED FORWARDING (AF) - A set của 12 STANDARD VALUES - CLASS SELECTOR (CS) - A set của 8 STANDARD VALUES, provides backward compatibility với IPP --- DF / EF Default FORWARDING (DF) ![image](https://github.com/psaumur/CCNA/assets/106411237/26f6bc76-6b33-40f0-9327-022b4816d280) - Used cho BEST EFFORT TRAFFIC - The DSCP Đánh dấu cho DF là 0 EXPEDITED FORWARDING (EF) ![image](https://github.com/psaumur/CCNA/assets/106411237/12cf77c0-f139-494c-ab8b-d765a73a92f4) - EF là used cho TRAFFIC that requires Low Loss / Latency / Jitter - The DSCP Đánh dấu cho EF là 46 --- ASSURED FORWARDING (AF) - Defines FOUR TRAFFIC CLASSES - ALL PACKETS trong một CLASS have the same PRIORITY - Within each CLASS, there là THREE LEVELS của DROP PRECEDENCE - HIGHER DROP PRECEDENCE = More likely đến DROP the Gói tin during CONGESTION ![image](https://github.com/psaumur/CCNA/assets/106411237/407ab29c-678d-4a38-8e8e-2a6f904b4d94) EXAMPLES: ![image](https://github.com/psaumur/CCNA/assets/106411237/d6b2dac7-fefc-409b-8136-f34df165dd23) ![image](https://github.com/psaumur/CCNA/assets/106411237/6543afb5-9aba-4d91-9d61-233c2c67958d) ![image](https://github.com/psaumur/CCNA/assets/106411237/fae89ed7-7229-4632-b3de-5415a36ad267) ![image](https://github.com/psaumur/CCNA/assets/106411237/a7440ed0-70d8-48c2-b83d-dcb4e169fade) ![image](https://github.com/psaumur/CCNA/assets/106411237/0d2d9ba8-fecc-47a8-9cee-02ae5a7a30e9) ![image](https://github.com/psaumur/CCNA/assets/106411237/05fa1552-e305-4e2d-b6aa-db0c8cbed3f7) ![image](https://github.com/psaumur/CCNA/assets/106411237/be10edd7-a4e3-4df6-a94f-b9e1b1c9e304) - AF41 gets the BEST TREATMENT (Highest Priority / Lowest Drop) - AF13 gets the WORST TREATMENT (Lowest Priority / Highest Drop) --- CLASS SELECTOR (CS) - Defines EIGHT DSCP values cho backward compatibility với IPP - The THREE BITS that were added cho DSCP là set đến 0, and the original IPP bits là used đến make 8 values ![image](https://github.com/psaumur/CCNA/assets/106411237/d7619e44-1ffd-4613-bbad-f2ff19ff6d2a) --- RFC 4954 - RFC 4954 was developed với help của Cisco đến bring ALL của these VALUES together và STANDARDIZE their use - The RFC offers MANY specific recommendations, but here là một few KEY ones: - VOICE TRAFFIC : EF - INTERACTIVE VIDEO : AF4x - STREAMING VIDEO : AF3x - HIGH PRIORITY DATA : AF2x - BEST EFFORT : DF --- TRUST BOUNDARIES - The TRUST BOUNDARY của một Mạng defines where the Thiết bị TRUST / DON’T TRUST the QoS MARKINGS của received messages - If the MARKINGS là TRUSTED: - Thiết bị sẽ forward the message without changing the MARKINGS - If the MARKINGS là NOT TRUSTED: - Thiết bị sẽ change the MARKINGS according đến configured POLICY ![image](https://github.com/psaumur/CCNA/assets/106411237/cdcdc302-9dbe-4dd8-9184-72d1f501bc1a) - If một IP PHONE là connected đến the Switch Cổng, it là RECOMMENDED đến move the TRUST BOUNDARY đến the IP PHONES - This là done via Cấu hình trên the Switch Cổng connected đến the IP PHONE - If một user MARKS their PC’s TRAFFIC với một HIGH PRIORITY, the Đánh dấu sẽ be CHANGED (not trusted) ![image](https://github.com/psaumur/CCNA/assets/106411237/606ad681-fad4-4f23-96bf-bd7dde91eaf4) --- QUEUING / CONGESTION Quản lý - When một Mạng Thiết bị receives TRAFFIC tại một FASTER PACE than it có thể FORWARD out của the appropriate INTERACE, PACKETS là placed trong that Giao diện’S QUEUE as they wait đến be FORWARDED - When một QUEUE becomes FULL, PACKETS that don’t FIT trong the QUEUE là dropped (Tail Drop) - RED và WRED DROP PACKETS early đến avoid TAIL DROP ![image](https://github.com/psaumur/CCNA/assets/106411237/5dbfd417-097c-4107-a5e1-b5476f423b15) - An essential part của QoS là the use của MULTIPLE QUEUES - This là where Phân loại plays một role. - Thiết bị có thể match TRAFFIC based trên various factors (like DSCP MARKINGS trong the IP Header) and then place it trong the appropriate QUEUE - HOWEVER, the Thiết bị là only able đến forward one Khung out của một Giao diện tại once SO a *SCHEDULER*, is used đến decide which QUEUE TRAFFIC là FORWARDED từ the next - *PRIORITZATION* allows the SCHEDULER đến give certain QUEUES more PRIORITY than others ![image](https://github.com/psaumur/CCNA/assets/106411237/56bfe184-5bdf-4b8f-8851-756766456bf9) - A COMMON scheduling method is *WEIGHTED ROUND-ROBIN* - ROUND-ROBIN: - PACKETS taken từ each QUEUE trong order, cyclically - WEIGHTED: - More DATA taken từ HIGH PRORITY QUEUES each time the SCHEDULER reaches that QUEUE --- - CBWFQ (CLASS BASED WEIGHED FAIR QUEUING) - Popular method của SCHEDULING - Uses WEIGHTED ROUND-ROBIN SCHEDULER while guaranteeing each QUEUE một certain PERCENTAGE của the Giao diện’S bandwidth during CONGESTION ![image](https://github.com/psaumur/CCNA/assets/106411237/eee24cef-c67a-42de-9fa0-9351cab56354) - ROUND-ROBIN SCHEDULING là NOT IDEAL cho VOICE / VIDEO TRAFFIC - Even if VOICE / VIDEO TRAFFIC receives một guaranteed MINIMUM amount của BANDWIDTH, ROUND-ROBIN có thể add DELAY và JITTER because even the HIGH PRIORITY QUEUES have đến wait their turn trong the SCHEDULER --- - LLQ (LOW LATENCY QUEUING) - Designates ONE (or more) QUEUES as *strict priority queues* - This means that if there là TRAFFIC trong the QUEUE, the SCHEDULER sẽ ALWAYS take the next Gói tin từ that QUEUE until it là EMPTY - This là VERY EFFECTIVE cho reducing the DELAY và JITTER của VOICE / VIDEO TRAFFIC - HOWEVER, LLQ has một DOWNSIDE của potentially starving other QUEUES if there là always TRAFFIC trong the DESIGNATED *STRICT PRIORITY QUEUE* - Kiểm soát có thể Kiểm soát the AMOUNT của TRAFFIC allowed trong the *STRICT PRIORITY QUEUE* so that it can’t take all của the link’s BANDWIDTH ![image](https://github.com/psaumur/CCNA/assets/106411237/2b544243-3a2e-4721-bf1f-4636ec4085a7) --- SHAPING / Kiểm soát - Định hình lưu lượng và Kiểm soát là both used đến Kiểm soát the RATE của TRAFFIC - SHAPING - Buffers TRAFFIC trong một QUEUE if the TRAFFIC RATE goes over the CONFIGURED RATE - Kiểm soát - DROPS TRAFFIC if the TRAFFIC RATE goes over the CONFIGURED RATE - Kiểm soát also has the option của RE-Đánh dấu the TRAFFIC, instead của DROPPING - “BURST” TRAFFIC over the CONFIGURED RATE là allowed cho một short period của time - This accommodates DATA APPLICATIONS which typically are “bursty” in nature (ie: not constant stream) - The amount của BURST TRAFFIC allowed là configurable - In BOTH cases, Phân loại có thể be used đến ALLOW cho different RATES cho different KINDS của TRAFFIC - WHY sẽ you want đến LIMIT the RATE that TRAFFIC là SENT / RECEIVED ? ![image](https://github.com/psaumur/CCNA/assets/106411237/09771d78-4570-4300-97e1-adba77fe28b4) 