# 27. OSPF : PART 2 (IGP : LINK STATE) OSPF Metric (Cost) - OSPFs Metric l√† called **COST** - It l√† automatically calculated based tr√™n the bandwidth (SPEED) of the Giao di·ªán - It l√† calculated b·ªüi DIVIDING m·ªôt REFERENCE BANDWIDTH value b·ªüi the Giao di·ªán bandwidth - The Default REFERENCE BANDWIDTH l√† 100 mbps - REFERENCE: 100 mbps / Giao di·ªán: 10 mbps = COST (10) - REFERENCE: 100 mbps / Giao di·ªán: 100 mbps = COST (1) - REFERENCE: 100 mbps / Giao di·ªán: 1000 mbps = COST (1) - REFERENCE: 100 mbps / Giao di·ªán: 10000 mbps = COST (1) - ALL COST values less than 1 s·∫Ω be CONVERTED ƒë·∫øn 1 - Therefore FastEthernet (100 mbps), Gigabit Ethernet (1000 mbps), 10 Gig Ethernet, etc. are EQUAL v√† all have m·ªôt COST c·ªßa 1 FastEthernet COST ![image](https://github.com/psaumur/CCNA/assets/106411237/453258a2-e724-4bf5-b07c-6c533dcef46c) Gigabit Ethernet COST ![image](https://github.com/psaumur/CCNA/assets/106411237/17adfd0e-8944-4016-93bd-98b82ceb8a66) You can (and SHOULD) change the REFERENCE BANDWIDTH v·ªõi this L·ªánh: üí° R1(config-Router)# **auto-cost reference-bandwidth** *megabits-per-second* The L·ªánh l√† entered in ‚Äúmegabits per second‚Äù (Default is ‚Äú100‚Äù) Example: using m·ªôt value of ‚Äú100000‚Äù - 100000 / 100 = COST c·ªßa 1000 cho FastEthernet - 100000 / 1000 = COST c·ªßa 100 cho Gig Ethernet You n√™n configure m·ªôt reference bandwidth GREATER than the FASTEST links trong your M·∫°ng (to allow cho future upgrades) Changing the REFERENCE BANDWIDTH needs ƒë·∫øn be done tr√™n ALL OSPF ROUTERS trong the M·∫°ng --- THE OSPF COST ƒë·∫øn m·ªôt DESTINATION l√† the TOTAL COST c·ªßa the ‚Äòoutgoing/exit INTERFACES‚Äô LOOPBACK INTERFACES have m·ªôt COST c·ªßa 1 ![image](https://github.com/psaumur/CCNA/assets/106411237/ef8de0f8-c22d-4259-bf4c-6fc9894bae29) To CHANGE the OSPF COST c·ªßa m·ªôt Giao di·ªán, you use the L·ªánh : <aside> üí° R1(config-if)# ip OSPF cost <cost> </aside> MANUAL COSTS take precedent over AUTOMATIC CALCULATED COST One more option ƒë·∫øn change the OSPF COST c·ªßa m·ªôt Giao di·ªán l√† ƒë·∫øn change the BANDWIDTH c·ªßa the Giao di·ªán v·ªõi the **‚Äúbandwidth‚Äù** L·ªánh The FORMULA ƒë·∫øn CALCULATE OSPF COST is : <aside> üí° **reference bandwidth / Giao di·ªán bandwidth** </aside> - Although the BANDWIDTH matches the Giao di·ªán SPEED (by Default), changing the Giao di·ªán BANDWIDTH **doesn‚Äôt actually change the speed t·∫°i which the Giao di·ªán operates** - The BANDWIDTH l√† just m·ªôt VALUE that l√† used ƒë·∫øn calculate OSPF COST, EIGRP Metric, etcetera‚Ä¶ - To CHANGE the SPEED t·∫°i which the Giao di·ªán operates, use the **‚Äúspeed‚Äù** L·ªánh - Because the BANDWIDTH VALUE l√† used trong other calculations, it l√† NOT recommended ƒë·∫øn change this VALUE ƒë·∫øn alter the Giao di·ªán‚Äôs OSPF COST It l√† RECOMMENDED that you CHANGE the REFERENCE BANDWIDTH THEN use the **‚Äúip OSPF cost‚Äù** L·ªánh ƒë·∫øn change the COST c·ªßa the individual INTERFACES, if you want. ![image](https://github.com/psaumur/CCNA/assets/106411237/00196380-4452-4ec9-8cd9-b1949665a5d8) --- SUMMARY: THREE WAYS ƒë·∫øn modify the OSPF COST: 1) Change the ***reference bandwidth*** <aside> üí° R1(config-Router)# **auto-cost reference-bandwidth** *megabits-per-second* </aside> 2) Manual C·∫•u h√¨nh: <aside> üí° R1(config-Router)# ip OSPF cost <cost> </aside> 3) Change the ***Giao di·ªán bandwidth*** <aside> üí° R1(config-Router)# **bandwidth <***kilobits-per-second>* </aside> ![image](https://github.com/psaumur/CCNA/assets/106411237/aba02fbc-174c-41a1-a8e3-0ffdda3a6cbd) --- BECOMING OSPF NEIGHBORS - Making sure that ROUTERS successfully become OSPF NEIGHBORS l√† the MAIN task trong configuring v√† Kh·∫Øc ph·ª•c s·ª± c·ªë OSPF. - Once ROUTERS become NEIGHBORS, they AUTOMATICALLY do the work c·ªßa sharing M·∫°ng information, calculating routes, etc. - When OSPF l√† activated tr√™n m·ªôt Giao di·ªán, the Router starts sending OSPF **‚Äúhello‚Äù** messages out c·ªßa the Giao di·ªán t·∫°i regular intervals (determined b·ªüi the **‚Äúhello timer‚Äù).** These l√† used ƒë·∫øn introduce the Router ƒë·∫øn potential OSPF NEIGHBORS - The Default ‚Äú**hello timer**‚Äù is **10 SECONDS** on m·ªôt Ethernet connection - **Hello** messages l√† Multicast to **224.0.0.5** (Multicast ƒê·ªãa ch·ªâ cho ALL OSPF ROUTERS) - OSPF messages l√† ENCAPSULATED trong m·ªôt IP Header, with a **value of ‚Äú89‚Äù** in the Giao th·ª©c field. DOWN STATE - OSPF l√† activated tr√™n R1s G0/0 Giao di·ªán - It sends m·ªôt OSPF ‚Äúhello‚Äù message ƒë·∫øn 224.0.0.5 - It doesn‚Äôt know about any OSPF neighbors yet, so the current neighbor state l√† DOWN ![image](https://github.com/psaumur/CCNA/assets/106411237/fa9b91da-e0c3-42d9-8c0a-eb47991b1894) INIT STATE - When R2 receives the ‚Äúhello‚Äù G√≥i tin, it s·∫Ω add m·ªôt entry cho R1 ƒë·∫øn its OSPF neighbor table - In R2‚Äôs neighbor table, the relationship v·ªõi R1 l√† now trong the INIT state - INIT state = ‚Äúhello‚Äù G√≥i tin received, but own Router ID l√† not trong the ‚Äúhello‚Äù G√≥i tin ![image](https://github.com/psaumur/CCNA/assets/106411237/70f3474f-f4bf-4194-b479-d7a65ad82505) 2-WAY STATE - R2 s·∫Ω send a ‚Äúhello‚Äù G√≥i tin containing the RID c·ªßa BOTH ROUTERS - R1 s·∫Ω insert R2 into its OSPF neighbor table trong the 2-WAY state - R1 s·∫Ω send another ‚Äúhello‚Äù message, this time containing R2‚Äôs RID - Both ROUTERS l√† now trong the 2-WAY state ![image](https://github.com/psaumur/CCNA/assets/106411237/4d5e5310-4680-4176-94ab-2d8015032d18) - The 2-WAY state means the Router has received a ‚Äúhello‚Äù G√≥i tin v·ªõi its own RID trong it - If both ROUTERS reach the 2-WAY state, it means that ALL c·ªßa the conditions have been met cho them ƒë·∫øn become OSPF neighbors. - They l√† now READY ƒë·∫øn SHARE LSAs ƒë·∫øn build m·ªôt common LSDB. - In SOME M·∫°ng types, a DR (Designated Router) and BDR (Backup Designated Router) will be elected t·∫°i this point (OSPF M·∫°ng Types v√† DR/DBR elections s·∫Ω be discussed trong Day 28) EXSTART STATE - The TWO ROUTERS s·∫Ω now prepare ƒë·∫øn exchange information about their LSDB - Before that, they have ƒë·∫øn choose which one s·∫Ω START the exchange - They do THIS trong the EXSTART state - The Router v·ªõi the higher RID s·∫Ω become the MASTER v√† initiate the exchange. - The Router v·ªõi the lower RID s·∫Ω become the SLAVE - To decide the MASTER v√† SLAVE, they exchange DBD (Database Description) packets ![image](https://github.com/psaumur/CCNA/assets/106411237/34fa7cca-f837-432b-9296-d1be69a8869c) EXCHANGE STATE - In the EXCHANGE state, the ROUTERS exchange DBDs which contain m·ªôt LIST c·ªßa the LSAs trong their LSDB - These DBDs do NOT include detailed information about the LSAs, just BASIC INFORMATION - The ROUTERS compare the information trong the DBD they received ƒë·∫øn the information trong their OWN LSDB ƒë·∫øn determine which LSAs they ph·∫£i receive t·ª´ their neighbor ![image](https://github.com/psaumur/CCNA/assets/106411237/600722df-4737-4a69-867e-662c03a6b4b4) LOADING STATE - In the LOADING state, ROUTERS send **Link State Requests (LSR)** messages ƒë·∫øn request that their neighbors SEND them any LSAs they don‚Äôt have - LSAs l√† sent in **Link State Update (LSU)** messages - The ROUTERS send **LSAck** messages ƒë·∫øn acknowledge that they received the LSAs ![image](https://github.com/psaumur/CCNA/assets/106411237/4fc0fc23-ce00-4381-afef-259091b8f8ef) FULL STATE - In the FULL state, the ROUTERS have m·ªôt FULL OSPF adjacency v√† identical LSDBs - They continue ƒë·∫øn SEND v√† LISTEN for ‚Äúhello‚Äù packets (every 10 seconds b·ªüi Default) to maintain the neighbor adjacency - Every time a ‚Äúhello‚Äù G√≥i tin l√† received, the ‚ÄúDEAD‚Äù timer (40 seconds b·ªüi Default) is reset - If the DEAD timer counts down ƒë·∫øn 0 v√† no ‚Äúhello‚Äù message l√† received, the neighbor l√† REMOVED - The ROUTERS s·∫Ω continue ƒë·∫øn share LSAs as the M·∫°ng changes ƒë·∫øn make sure each Router has m·ªôt COMPLETE v√† ACCURATE map c·ªßa the M·∫°ng (LSDB) ![image](https://github.com/psaumur/CCNA/assets/106411237/daaa3a7b-ddd0-4ad0-ace7-056cbf2fbe32) --- OSPF NEIGHBORS SUMMARY: ![image](https://github.com/psaumur/CCNA/assets/106411237/0d9f9d7e-04fd-472c-8449-a4f12172c055) 1 ) BECOME NEIGHBORS - DOWN STATE - INIT STATE - 2-WAY STATE - (DR/BDR ELECTION) 2) EXCHANGE LSAs - EXSTART STATE - EXCHANGE STATE - LOADING STATE --- SUMMARY c·ªßa OSPF MESSAGE TYPES ![image](https://github.com/psaumur/CCNA/assets/106411237/05b6d3ee-8fdb-4f25-9214-557eeb9a53a6) --- MORE OSPF CONFIGURATIONS Activate OSPF DIRECTLY tr√™n m·ªôt Giao di·ªán v·ªõi this L·ªánh: <aside> üí° R1(config-if)# ip OSPF *process-id* area *area* </aside> ![image](https://github.com/psaumur/CCNA/assets/106411237/ad7aafd6-9cd8-4259-bd32-aff7b5893b46) Configure ALL INTERFACES as OSPF Passive Interfaces <aside> üí° R1(config-Router) #passive-Giao di·ªán Default </aside> ![image](https://github.com/psaumur/CCNA/assets/106411237/e953696d-283f-4676-8df2-9aff0418d78d) Can then REMOVE specific INTERFACES t·ª´ being passive using: <aside> üí° R1(config-Router) #no passive-Giao di·ªán *Giao di·ªán-id* </aside> Activating OSPF DIRECTLY tr√™n INTERFACES s·∫Ω show m·ªôt different output in ‚Äúshow ip protocols‚Äù ![image](https://github.com/psaumur/CCNA/assets/106411237/915e31ee-4fee-455b-a947-229e0af4b182) They s·∫Ω appear under ‚Äúƒê·ªãnh tuy·∫øn tr√™n Interfaces Configured Explicitly (Area #) :‚Äù (as above) Showing the OSPF LSDB c·ªßa m·ªôt Thi·∫øt b·ªã ![image](https://github.com/psaumur/CCNA/assets/106411237/75c941ca-b6bd-45f0-9a85-c7e5baff4654) 