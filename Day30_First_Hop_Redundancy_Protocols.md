# 29. FIRST HOP REDUNDANCY PROTOCOLS M·ª•c ƒë√≠ch c·ªßa FHRPS ![image](https://github.com/psaumur/CCNA/assets/106411237/32c286ce-e042-4cda-9067-c232a210ec81) What happens when the configured Gateway m·∫∑c ƒë·ªãnh cho M·∫°ng HOSTS goes down ? What happens ƒë·∫øn the routed traffic? How c√≥ th·ªÉ we Tuy·∫øn ƒë∆∞·ªùng our traffic ƒë·∫øn the functional Gateway t·∫°i R2 (.253) ? This l√† what the FIRST HOP REDUNDANCY Giao th·ª©c l√† designed ƒë·∫øn fix --- FIRST HOP REDUNDANCY Giao th·ª©c (FHRP) - Computer networking Giao th·ª©c - Designed ƒë·∫øn PROTECT the Gateway m·∫∑c ƒë·ªãnh used tr√™n m·ªôt M·∫°ng con b·ªüi allowing TWO ho·∫∑c MORE ROUTERS ƒë·∫øn provide BACKUP cho that ƒê·ªãa ch·ªâ - In the event c·ªßa m·ªôt FAILURE c·ªßa the ACTIVE Router, the BACKUP Router s·∫Ω take over the ƒê·ªãa ch·ªâ (usually within seconds) --- HOW DOES FHRP WORK? - TWO (or more) ROUTERS share m·ªôt VIP (A Virtual ƒê·ªãa ch·ªâ IP) - THIS VIP l√† used b·ªüi HOSTS as the DEFAULY Gateway IP - The ROUTERS communicate v·ªõi each other b·ªüi sending ‚ÄúHello‚Äù messages - One Router becomes the ACTIVE Router, the other(s) STANDBY - When m·ªôt HOST sends traffic ƒë·∫øn m·ªôt ƒê·ªãa ch·ªâ outside c·ªßa the M·∫°ng, it sends m·ªôt ARP REQUEST (Broadcast Flood) to the VIP ƒë·∫øn find out it‚Äôs ƒê·ªãa ch·ªâ MAC - Spanning Tree prevents Broadcast STORM due ƒë·∫øn Broadcast Flood - The ACTIVE Router sends the ARP REPLY back (it‚Äôs VIRTUAL ƒê·ªãa ch·ªâ MAC) to the HOST - The HOST now sends traffic OUTSIDE c·ªßa the M·∫°ng with: - Source IP (HOST IP) - Destination IP (External ƒê·ªãa ch·ªâ IP) - Source MAC (HOST ƒê·ªãa ch·ªâ MAC) - Destination MAC (Gateway VIP ƒê·ªãa ch·ªâ MAC) ![image](https://github.com/psaumur/CCNA/assets/106411237/2a1c5df8-d4fa-44fa-b850-a8fd6bb69388) IF R1 goes down, R2 s·∫Ω Switch t·ª´ STANDY ƒë·∫øn ACTIVE after not receiving ‚ÄúHello‚Äù messages t·ª´ R1 ![image](https://github.com/psaumur/CCNA/assets/106411237/5e54ee53-09bd-42a7-b89e-69892590913d) The HOST ARP TABLE doesn‚Äôt need ƒë·∫øn change since the ƒê·ªãa ch·ªâ MAC c·ªßa the VIP l√† already known v√† traffic flows externally via R2 R2 DOES need ƒë·∫øn update the SWITCHES v·ªõi m·ªôt GRATUITOUS ARP - GRATUITOUS ARP l√† m·ªôt ARP REPLY sent without being REQUESTED (no ARP REQUEST received) - GRATUITOUS ARP uses Broadcast (FFFF.FFFF.FFFF) - Normal ARP REPLY l√† Unicast ![image](https://github.com/psaumur/CCNA/assets/106411237/6a47dc71-544e-4e33-99cd-b6a8db90f56f) ![image](https://github.com/psaumur/CCNA/assets/106411237/6f36cdf9-d002-48d6-ae5b-6fb899431b46) What happens l√† R1 comes back ONLINE again? It becomes m·ªôt STANDBY Router R2 remains the ACTIVE Router <aside> üí° FPRPs are ‚Äúnon-preemptive‚Äù. The current ACTIVE Router s·∫Ω not automatically give up its role, even if the former ACTIVE Router returns. *** You c√≥ th·ªÉ change this setting ƒë·∫øn make R1 ‚Äòpreempt‚Äô R2 v√† take back it‚Äôs ACTIVE role, automatically *** </aside> --- HSRP (HOT STANDBY Router Giao th·ª©c) - **Cisco proprietary** - An ACTIVE v√† STANDBY Router l√† elected - There l√† TWO VERSIONS : - version 1 - version 2 : *adds IPv6 support* and increases # of *groups* that c√≥ th·ªÉ be configured - Multicast IPv4 ADDRESSES : - **v1** : 224.0.0.2 - **v2** : 224.0.0.102 - VIRTUAL MAC ADDRESSES : - **v1** : 0000.0c07.acXX (XX = HSRP GROUP NUMBER) - **v2** : 0000.0c9f.fXXX (XXX = HSRP GROUP NUMBER) - In m·ªôt situation v·ªõi MULTIPLE SUBNETS / VLANS, you c√≥ th·ªÉ configure m·ªôt DIFFERENT ACTIVE Router trong EACH M·∫°ng con / VLAN ƒë·∫øn LOAD BALANCE ![image](https://github.com/psaumur/CCNA/assets/106411237/a5795fa0-d57b-4037-8945-a39da7fb2d15) --- VRRP (VIRTUAL Router REDUNDANCY Giao th·ª©c) - Open Standard - A MASTER v√† BACKUP Router l√† elected - Multicast IPv4 ADDRESSES : - 224.0.0.18 - VIRTUAL MAC ADDRESSES : - 0000.5e00.01XX (XX = VRRP GROUP NUMBER) - for GROUP NUMBERS > 99, you need ƒë·∫øn convert the number ƒë·∫øn HEX - Example: 200 = ‚Äúc8‚Äù in Hex so the MAC s·∫Ω be 0000.5e00.01c8 - In m·ªôt situation v·ªõi MULTIPLE SUBNETS / VLANS, you c√≥ th·ªÉ configure m·ªôt DIFFERENT MASTER Router trong EACH M·∫°ng con / VLAN ƒë·∫øn LOAD BALANCE ![image](https://github.com/psaumur/CCNA/assets/106411237/4bd45dbc-fc51-4c45-818e-5274530accde) --- GLBP (Gateway LOAD BALANCING Giao th·ª©c) - Cisco Proprietary - LOAD BALANCES among MULTIPLE ROUTERS within m·ªôt SINGLE M·∫°ng con - An AVG (Active Virtual Gateway) is elected - Up ƒë·∫øn FOUR AVFs (Active Virtual Forwarders) are assigned b·ªüi the AVG (the AVG c√≥ th·ªÉ be m·ªôt AVF, too) - Each AVF acts as the Gateway m·∫∑c ƒë·ªãnh cho m·ªôt portion c·ªßa the HOSTS trong the M·∫°ng con - Multicast IPv4 ADDRESSES : - 224.0.0.102 - VIRTUAL MAC ADDRESSES : - 0007.b400.XXYY (XX = GLBP GROUP NUMBER, YY = AVF NUMBER) --- MEMORIZE THIS CHART v√† the differences between the FHRPs ![image](https://github.com/psaumur/CCNA/assets/106411237/a5b5ee87-4c92-4b3e-9b98-3d0c09a1732d) --- BASIC HSRP C·∫•u h√¨nh R1s C·∫•u h√¨nh ![image](https://github.com/psaumur/CCNA/assets/106411237/028b13d4-b258-4551-96ae-068adb931356) NOTE : group number has ƒë·∫øn match ALL ROUTERS being configured trong m·ªôt given M·∫°ng con ![image](https://github.com/psaumur/CCNA/assets/106411237/d2e5eb5f-d105-4788-a869-d9e65f53eca7) R2‚Äôs C·∫•u h√¨nh ![image](https://github.com/psaumur/CCNA/assets/106411237/65b999f6-eed8-45c3-89fe-bff749f40f11) NOTE : HSRP versions l√† not cross-compatible. All ROUTERS ph·∫£i use the same HSRP Version Output c·ªßa the ‚Äúshow standby‚Äù L·ªánh ![image](https://github.com/psaumur/CCNA/assets/106411237/99107301-2619-4454-b104-8aed3780924d) 