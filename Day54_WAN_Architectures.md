# 53. WAN ARCHITECTURES INTRODUCTION đến WANS - WAN stands cho WIDE AREA Mạng - A WAN là một Mạng that extends over một large geographic area - WANs là used đến connect geographically separate LANs - Although the Internet có thể be considered một WAN, the term “WAN” is typically used đến refer đến một Doanh nghiệp’s private connections that connect their offices, data centers, and other sites together - Over public/shared networks like the Internet, VPNs (Virtual Private Networks) can be used đến create private WAN connections - There have been many different WAN technologies over the years. Depending trên the location, some sẽ be available và some sẽ not be - Technologies which là considered “legacy” (old) in one country, might still be used trong other countries --- WAN OVER DEDICATED CONNECTION (LEASED LINE) Hub-and-SPOKE Cấu trúc mạng ![image](https://github.com/psaumur/CCNA/assets/106411237/57575fad-883d-4999-a56d-a77fa1542976) ![image](https://github.com/psaumur/CCNA/assets/106411237/cfc23064-a133-445a-b854-e044828eca7d) WAN CONNECTION VIA Ethernet (FIBER) ![image](https://github.com/psaumur/CCNA/assets/106411237/022ccdbd-7ce9-41fd-9f99-9e9c6dcb9f76) WAN OVER SHARED Hạ tầng (Internet VPN) ![image](https://github.com/psaumur/CCNA/assets/106411237/38eff264-7ed4-43fd-943b-47e9e1ce995e) --- LEASED LINES - A LEASED LINE là một dedicated physical link, typically connecting two sites - LEASED LINES use serial connections (PPP hoặc HDLC Đóng gói) - There là various standards that provide different speeds và different standards là available trong different countries. - Due đến the HIGHER cost, HIGHER installation lead time, and SLOWER speeds của LEASED LINES, Ethernet WAN technologies là becoming MORE popular ![image](https://github.com/psaumur/CCNA/assets/106411237/77dd5503-8b29-4919-8747-6dd80eec28fa) MPLS VPNs - MPLS stands for “Multi Giao thức Label Chuyển mạch” - Similar đến the Internet, service providers’ MPLS NETWORKS là shared Hạ tầng because many customer enterprises connect đến và share the same Hạ tầng đến make WAN connections - However, the “label Chuyển mạch” in the name của MPLS allows VPNs đến be created over the MPLS Hạ tầng through the use của LABELS - IMPORTANT terms: - CE Router = Customer Edge Router - PE Router = Provider Edge Router - P Router = Provider Core Router ![image](https://github.com/psaumur/CCNA/assets/106411237/166bff5b-d977-48dc-9a74-b9a523b91e1b) - When the PE ROUTERS receive FRAMES từ the CE ROUTERS, they add một LABEL đến the Khung - These LABELS là used đến make forwarding decisions within the SERVICE PROVIDER Mạng - NOT the DESTINATION IP - The CE ROUTERS do NOT USE MPLS, it là only used bởi the PE/P ROUTERS - When using một LAYER 3 MPLS VPN, the CE và PE ROUTERS peer using OSPF, Ví dụ, to share Định tuyến information EXAMPLE: OFFICE A’s CE sẽ peer với one PE OFFICE B’s CE sẽ peer với the other PE OFFICE A’s CE sẽ learn about OFFICE B’s ROUTES via this OSPF peering OFFICE B’s CE sẽ learn about OFFICE A’s ROUTES as well ![image](https://github.com/psaumur/CCNA/assets/106411237/2b3d8d6e-3501-4d54-a6f8-5a05c9140d24) - When using một LAYER 2 MPLS VPN, the CE và PE ROUTERS do NOT form PEERINGS - The SERVICE PROVIDER Mạng là entirely *transparent* to the CE ROUTERS - In effect, it là like the TWO CE ROUTERS là directly connected. - Their WAN INTERFACES sẽ be trong the SAME Mạng con - If một Định tuyến Giao thức là used, the TWO CE ROUTERS sẽ peer directly với each other CE ROUTERS connected via LAYER 2 MPLS VPN ![image](https://github.com/psaumur/CCNA/assets/106411237/b0b19dfd-e417-40ce-ac36-ce0ace8484cc) ![image](https://github.com/psaumur/CCNA/assets/106411237/cc5c9508-a2b0-4fe7-9c83-6c03e7d2d861) --- MPLS - Many different technologies có thể be used đến connect đến một SERVICE PROVIDER’s MPLS Mạng cho WAN Service ![image](https://github.com/psaumur/CCNA/assets/106411237/c6e6e60d-2a96-415e-82a2-a090c38a68a3) Internet CONNECTIVITY - There là countless ways cho một Doanh nghiệp đến connect đến the Internet - Ví dụ, PRIVATE WAN technologies such as LEASED LINES và MPLS VPNs có thể be used đến connect đến một SERVICE PROVIDER’s Internet Hạ tầng - In addition, technologies such as CATV và DSL commonly used bởi consumers (Home Internet Truy cập) can also be used bởi một Doanh nghiệp - These days cho both Doanh nghiệp và consumer Internet Truy cập, FIBER OPTIC Ethernet connections là growing trong popularity due đến high speeds they provide over long distances - Let’s briefly look tại TWO Internet Truy cập technologies mentioned above: - Cáp (CATV) - DSL --- DIGITAL SUBSCRIBER LINE (DSL) - DSL provides Internet connectivity đến customers over phone lines và có thể share the same phone line that là already installed trong most homes - A DSL MODEM (Modulator / Demodulator) is required đến convert DATA into một format suitable đến be sent over the phone lines - The MODEM có thể be một separate Thiết bị hoặc it có thể be incorporated trong đến a “HOME Router” ![image](https://github.com/psaumur/CCNA/assets/106411237/a708b6b4-6de5-4a72-8c77-13f569f4c2d5) Cáp Internet - Cáp Internet provides Internet Truy cập via the same CATV (Cáp Television) lines used cho TV service - Like DLS, a Cáp MODEM là required đến convert DATA into một format suitable đến be sent over the CATV CABLES. - Like một DSL MODEM, this có thể be một separate Thiết bị hoặc built into the HOME Router ![image](https://github.com/psaumur/CCNA/assets/106411237/a33bb999-83bc-49a8-ad37-e7ca91fcb954) --- REDUNDANT Internet CONNECTIONS ![image](https://github.com/psaumur/CCNA/assets/106411237/af770f82-a55c-4af5-af7b-5708b39833c4) --- Internet VPNs - PRIVATE WAN SERVICES such as LEASED LINES và MPLS provide Bảo mật because each customer’s TRAFFIC là separated bởi using dedicated physical connections (LEASED LINE) or bởi MPLS TAGS - When using the Internet as một WAN đến connect SITES together, there là no built-in Bảo mật bởi Default - To provide secure communications over the Internet, VPNs (Virtual Private Networks) are used - We sẽ cover two kinds của Internet VPNs: - SITE-TO-SITE VPNS using IPSec - REMOTE-Truy cập VPNs using TLS SITE-TO-SITE VPNs (IPSec) - A “SITE-TO-SITE” VPN là một VPN between two DEVICES và là used đến connect TWO SITES together over the Internet - A VPN “TUNNEL” is created between the TWO DEVICES bởi ENCAPSULATING the original IP Gói tin với một VPN Header và một new IP Header - When using IPSec, the original Gói tin là encrypted before its ENCAPSULATED với the new Header ![image](https://github.com/psaumur/CCNA/assets/106411237/b17c6149-90b2-4bc7-beb7-c53698d588a0) ![image](https://github.com/psaumur/CCNA/assets/106411237/d41295a9-af54-4cd5-acc8-4b60c39c40c2) PROCESS SUMMARY: 1) The SENDING Thiết bị combines the original Gói tin và SESSION KEY (Mã hóa KEY) and runs them through một Mã hóa FORMULA 2) The SENDING Thiết bị encapsulates the ENCRYPTED Gói tin với một VPN Header và một new IP Header 3) The SENDING Thiết bị sends the NEW Gói tin đến the Thiết bị trên the other side của the TUNNEL 4) The RECEIVING Thiết bị decrypts the DATA đến get the original Gói tin và then forwards the original Gói tin đến it’s DESTINATION - In a “SITE-TO-SITE” VPN, a TUNNEL là formed only between TWO TUNNEL ENDPOINTS (Ví dụ, the TWO ROUTERS connected đến the Internet) - All OTHER DEVICES trong each site DO NOT need đến create một VPN cho themselves. They có thể send unencrypted DATA đến their site’s Router, which sẽ ENCRYPT it và FORWARD it trong the TUNNEL as described above. --- LIMITATIONS của STANDARD IPSec 1) IPSec doesn’t support Broadcast hoặc Multicast TRAFFIC, only Unicast. - This means that Định tuyến PROTOCOLS such as OSPF cannot be used over the TUNNELS because they rely trên Multicast TRAFFIC - This có thể be SOLVED with “GRE over IPSec” 2) Configuring một full mesh của TUNNELS between many sites là một labor-intensive task Let’s look tại each của the above SOLUTIONS --- GRE over IPSec - GRE (GENERIC Định tuyến Đóng gói) creates TUNNELS like IPSec, however it does not ENCRYPT the original Gói tin, so it là NOT SECURE - However, it has the advantage của being able đến encapsulate một WIDE variety của một LAYER 3 PROTOCOLS as well as Broadcast và Multicast messages - To get the FLEXIBILITY của GRE với the Bảo mật của IPSec, “GRE over IPSec” can be used - The original Gói tin sẽ be ENCAPSULATED bởi một GRE Header và một new IP Header, and then the GRE Gói tin sẽ be ENCRYPTED và ENCAPSULATED within một IPSec VPN Header và một NEW IP Header ![image](https://github.com/psaumur/CCNA/assets/106411237/09c7da0c-debe-453e-822c-b97c0b8658ef) ![image](https://github.com/psaumur/CCNA/assets/106411237/3dfd6b86-28bb-489d-931b-5cc74669c1ac) ![image](https://github.com/psaumur/CCNA/assets/106411237/939ce5af-5ffc-44da-96fc-def2ca99ecae) --- DMVPN - DMVPN (Dynamic Multipoint VPN) is một Cisco-Developed solution that allows ROUTERS đến dynamically create một FULL MESH của IPSec TUNNELS without having đến manually configure every SINGLE TUNNEL 1) CONFIGURE IPSec TUNNELS đến một Hub SITE ![image](https://github.com/psaumur/CCNA/assets/106411237/00c33e7f-2b28-4a33-908d-7aceff1e4092) 2) The Hub Router gives each Router information about Cách form một IPSec TUNNEL với the OTHER ROUTERS ![image](https://github.com/psaumur/CCNA/assets/106411237/7a621160-10d4-4e14-868b-3c23f6bb0a64) DMVPN provides the Cấu hình simplicity của Hub-AND-SPOKE (each SPOKE Router only needs one TUNNEL configured) and the EFFICIENCY của DIRECT SPOKE-TO-SPOKE communication (SPOKE ROUTERS có thể communicate directly without TRAFFIC passing through the Hub) --- REMOTE-Truy cập VPNs - Whereas SITE-TO-SITE VPNs là used đến make một POINT-TO-POINT connection between TWO SITES over the Internet, REMOTE-Truy cập VPNs là used đến allow END DEVICES (PCs, Mobile Phone) to Truy cập the company’s internal resources securely over the Internet - REMOTE-Truy cập VPNs typically use TLS (TRANSPORT LAYER Bảo mật) - TLS là also what provides Bảo mật cho HTTPS (HTTP SECURE) - TLS was formerly known as SSL (Secure Socket Layer) and developed bởi Netscape, but it was renamed đến TLS when it was standardized bởi the IETF - VPN client software (Ví dụ Cisco AnyConnect) is installed trên END DEVICES (Ví dụ company-provided laptops that employees use đến work từ home) - These END DEVICES then form SECURE TUNNELS đến one của the company’s ROUTERS / FIREWALLS acting as một TLS SERVER - This allows the END USERS đến securely Truy cập RESOURCES trên the company’s INTERNAL Mạng without being directly connected đến the company Mạng ![image](https://github.com/psaumur/CCNA/assets/106411237/f4a77cb7-9d42-4daa-9a25-630c0fb260cf) --- SITE-TO-SITE versus REMOTE-Truy cập VPN - SITE-TO-SITE VPNs typically use IPSec - REMOTE-Truy cập VPNs typically use TLS - SITE-TO-SITE VPNs provide SERVICE đến many DEVICES within the SITES they là connecting - REMOTE-Truy cập VPNs provide SERVICE đến the ONE END Thiết bị the VPN CLIENT SOFTWARE là installed on - SITE-TO-SITE VPNs là typically used đến permanently connect TWO SITES over the Internet - REMOTE-Truy cập VPNs là typically used đến provide ON-DEMAND Truy cập cho END DEVICES that want đến securely Truy cập company resources while connected đến một Mạng which là not SECURE --- LAB COMMANDS Create the Tunnel Giao diện `R1(config)#int tunnel <tunnel number>` This changes the mode đến the Tunnel Giao diện The exit Giao diện cho the tunnel `tunnel source <interface>` IP của the Tunnel Destination Giao diện `tunnel destination <destination ip address>` Set the IP của the Source Tunnel Giao diện (from step 1) `ip address <tunnel IP> <netmask>` Configure một Default Tuyến đường đến the Service Provider Mạng `R1(config)#ip route 0.0.0.0 0.0.0.0 <next hop interface>` This sẽ now bring the Tunnel Giao diện Administratively Up / Up ================================================ Now you need đến set up the TUNNEL ROUTERS as OSPF Neighbors cho the Service Provider Mạng so they có thể share routes `R1(config)router ospf <ospf process ID>` This switches đến the OSPF Router Cấu hình mode `network <tunnel interface IP> <wildcard mask> area <area #>` Since the tunnel là một single HOST, you sẽ use 0.0.0.0 cho the Wildcard Mask `network <router gateway IP> <wildcard mask> area <area #>` Since the Router Gateway là also một single HOST, you sẽ use 0.0.0.0 cho the Wildcard Mask `passive-interface <router gateway IP interface>` This removes the Router Gateway từ broadcasting over OSPF 