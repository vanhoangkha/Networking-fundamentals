# NGÀY 18: VLAN PART2 ## 18.1 CẤU TRÚC MẠNG VLAN CƠ BẢN TỪ PHẦN 1 ![image](HTTPS: //github.com/psaumur/CCNA/assets/106411237/f6df37e0 - d494 - 4e46 - b6e8 - 6d2ba0cd0ff6) ## 18.2 CẤU TRÚC MẠNG PHỨC TẠP HỠN? ![image](HTTPS: //github.com/psaumur/CCNA/assets/106411237/e6aff877 - 3792 - 469f - 8955 - 0f3e17c6f1ed) Chú ý cấu trúc này có **HAI switch** (SW1 và SW2) và **ENGINEERING (VLAN 10)** có hai vị trí riêng biệt trên Mạng. **Đặc điểm:** ## 18.3 TRUNK PORT ## 18.4 # Vấn đề với nhiều VLAN: - Trong mạng nhỏ với ít VLAN, có thể sử dụng **Giao diện riêng biệt cho MỖI VLAN** khi kết nối switch với switch, và switch với router - **TUY NHIÊN**, khi số lượng VLAN tăng lên, điều này không khả thi: • Lãng phí giao diện • router thường không có đủ INTERFACE cho mỗi VLAN ## 18.5 # Giải pháp: TRUNK PORT **Bạn có thể sử dụng Trunk PORT để mạng lưu lượng từ nhiều VLAN qua một Giao diện duy nhất** ## 18.6 # Trunk Port mạng nhiều kết nối VLAN qua một Giao diện duy nhất ![image](HTTPS: //github.com/psaumur/CCNA/assets/106411237/5cb7c933 - 689a - 499b - 9f30 - 51fe63d8b059) ![image](HTTPS: //github.com/psaumur/CCNA/assets/106411237/8ea9a799 - cf0d - 4b1d - 9706 - db002772fe6d) ## 18.7 # Làm thế nào Gói tin biết GỬI đến VLAN NÀO qua Trunk Port? **VLAN TAGS!** switch sẽ **"tag"** tất cả khung mà chúng gửi qua Trunk LINK. Điều này cho phép switch nhận biết VLAN nào mà Khung thuộc về. - **Trunk Port** = "Tagged" port - **Access Port** = "Untagged" port **Đặc điểm:** ## 18.8 VLAN TAGGING ## 18.9 # Có HAI giao thức Trunk chính: 1. **ISL (Inter - switch Link)** 2. **IEEE 802.1Q** (còn gọi là "dot1q") ## 18.10 # So sánh:**ISL: ** - Giao thức độc quyền cũ của Cisco - Được tạo trước tiêu chuẩn công nghiệp IEEE 802.1Q **IEEE 802.1Q:** - Giao thức tiêu chuẩn công nghiệp - Được tạo bởi IEEE (Institute of Electrical and Electronics Engineers) **Lưu ý:** Bạn có thể sẽ KHÔNG BAO GIỜ sử dụng ISL trong thế giới thực; ngay cả thiết bị Cisco hiện đại cũng không sử dụng nó. **Cho CCNA, bạn chỉ cần học 802.1Q** **Đặc điểm:** ## 18.11 Ethernet HEADER VỚI 802.1Q ![image](HTTPS: //github.com/psaumur/CCNA/assets/106411237/00e817cd - 1cac - 44c5 - a5f6 - 5459d383236d) ## 18.12 # Cấu trúc 802.1Q Tag: - **802.1Q TAG** được chèn giữa trường **SOURCE** và **TYPE/LENGTH** trong Khung Ethernet - **TAG** dài **4 byte (32 bit)** - **TAG** bao gồm HAI trường chính: • **Tag Protocol Identifier (TPID)** • **Tag Control Information (TCI)** ## 18.13 # TCI bao gồm BA trường con: ![image](HTTPS: //github.com/psaumur/CCNA/assets/106411237/8e52856b - 58b9 - 448e - a007 - 254973fe707e) **Đặc điểm:** ## 18.14 CHI TIẾT CÁC TRƯỜNG ## 18.15 # TPID (Tag Protocol Identifier): - **16 bit (2 byte)** độ dài - Luôn được đặt thành giá trị **0x8100** - Chỉ ra rằng Khung là 802.1Q TAG ## 18.16 # TCI / PCP (Priority Code Point): - **3 bit** độ dài - Được sử dụng cho **Class of Service (CoS)**, ưu tiên lưu lượng quan trọng trong mạng tắc nghẽn ## 18.17 # TCI / DEI (Drop Eligible Indicator): - **1 bit** độ dài - Được sử dụng để chỉ ra các khung có thể bị loại bỏ nếu Mạng bị tắc nghẽn ## 18.18 # TCI / VID (VLAN ID): - **12 bit** độ dài - Xác định VLAN mà Khung thuộc về - **12 bit** = 4096 tổng VLAN (2^12), phạm vi 0 - 4095 - **VLAN 0 và 4095** được dành riêng và không thể sử dụng - **Phạm vi thực tế của VLAN là 1 - 4094** **Lưu ý:** ISL của Cisco cũng có phạm vi VLAN từ 1 - 4094 **Đặc điểm:** ## 18.19 PHẠM VI VLAN ![image](HTTPS: //github.com/psaumur/CCNA/assets/106411237/1c55a830 - bfdd - 423a - 9688 - 334a3dd2bfa3) ## 18.20 # Phân loại VLAN: - **Normal Range:** 1 - 1005 - **Extended Range:** 1006 - 4094 **Đặc điểm:** ## 18.21 NATIVE VLAN ![image](HTTPS: //github.com/psaumur/CCNA/assets/106411237/8b1e09a1 - e9c5 - 410e - ad87 - 581b95eaca81) ![image](HTTPS: //github.com/psaumur/CCNA/assets/106411237/f8145795 - b3f7 - 4766 - 9507 - 4fba7c743a14) ![image](HTTPS: //github.com/psaumur/CCNA/assets/106411237/a1811276 - c043 - 4035 - 9957 - 800873068615) ## 18.22 # Đặc điểm Native VLAN: - **VLAN 1** là Native VLAN mặc định - Khung của Native VLAN **KHÔNG được tag** trên trunk link - Cả hai đầu của trunk link phải có **cùng Native VLAN** - Được sử dụng cho **management traffic** và **untagged frames** **Đặc điểm:** ## 18.23 CẤU HÌNH TRUNK ![image](HTTPS: //github.com/psaumur/CCNA/assets/106411237/d73b8f0b - 2154 - 4e7f - 8057 - 7c5b3f5078cc) ![image](HTTPS: //github.com/psaumur/CCNA/assets/106411237/29313a87 - cf16 - 439c - 8a9e - 90b518326954) ## 18.24 # Lưu ý quan trọng: - Nhiều switch hiện đại **không hỗ trợ ISL** của Cisco - Chúng chỉ hỗ trợ **802.1Q (dot1q)** - switch hỗ trợ cả hai có **Trunk Encapsulation "AUTO"** theo Mặc định ## 18.25 # Các bước cấu hình Trunk thủ công:**1) Chọn Giao diện để cấu hình** **2) Đặt Encapsulation type:** ``` switch(config - if)# switchport trunk encapsulation dot1q ``` **3) Cấu hình Giao diện làm Trunk:** ``` switch(config - if)# switchport mode trunk ``` ![image](HTTPS: //github.com/psaumur/CCNA/assets/106411237/6b897fb0 - 14a3 - 4e6a - b4e8 - e278a6aec08e) ## 18.26 # Kiểm tra cấu hình Trunk: ``` switch# show interfaces trunk ``` ![image](HTTPS: //github.com/psaumur/CCNA/assets/106411237/d3e144c7 - 90e3 - 4ab0 - 8021 - 7eb4d1420282) **Đặc điểm:** ## 18.27 QUẢN LÝ VLAN TRÊN TRUNK ## 18.28 # Cho phép VLAN trên Trunk: ``` switch(config - if)# switchport trunk allowed VLAN <VLAN - list> ``` ![image](HTTPS: //github.com/psaumur/CCNA/assets/106411237/6a60f6ce - 55be - 4df5 - a715 - b871e5e461f4) ![image](HTTPS: //github.com/psaumur/CCNA/assets/106411237/b39b091d - 1ea9 - 4f72 - b592 - 1eeb8ef25f90) ## 18.29 # Thay đổi Native VLAN: ``` switch(config - if)# switchport trunk native VLAN <VLAN - id> ``` ![image](HTTPS: //github.com/psaumur/CCNA/assets/106411237/5109becb - 27dd - 4c63 - 9c7b - 74b6f55e9d5f) ![image](HTTPS: //github.com/psaumur/CCNA/assets/106411237/36abc437 - 69cb - 4c56 - 8a59 - 87479ce01a7f) **Đặc điểm:** ## 18.30 THIẾT LẬP TRUNK CHO MẠNG ![image](HTTPS: //github.com/psaumur/CCNA/assets/106411237/892b5322 - 807b - 4d76 - 91cb - a039766794c5) ## 18.31 # Cần cấu hình: - **SW1:** g0/0 Interface (đã cấu hình ở trên) - **SW2:** g0/0 và g0/1 Interface ## 18.32 # SW2 g0/0: ![image](HTTPS: //github.com/psaumur/CCNA/assets/106411237/7b313959 - b710 - 4bb6 - a281 - 727ec9477c3e) ## 18.33 # SW2 g0/1: ![image](HTTPS: //github.com/psaumur/CCNA/assets/106411237/c26f17c8 - 0ec9 - 4406 - ab66 - 83adf28c8550) **Còn router R1 thì sao?** **Đặc điểm:** ## 18.34 router ON A STICK (ROAS) ![image](HTTPS: //github.com/psaumur/CCNA/assets/106411237/66c4ace0 - 8341 - 4c9c - 8ff5 - 7c171034df53) ![image](HTTPS: //github.com/psaumur/CCNA/assets/106411237/b409165d - 39e6 - 4fba - ade1 - 2451f7e2fa8c) ![image](HTTPS: //github.com/psaumur/CCNA/assets/106411237/112a2089 - 5a9e - 4b13 - 945c - 6be7f188d6a8) ## 18.35 # Cấu hình Sub - Interface: **Lưu ý tên Sub - Interface** (như sơ đồ Mạng): 0.10, 0.20 và 0.30 Bạn gán địa chỉ IP cho chúng giống hệt như Giao diện thông thường (sử dụng địa chỉ IP cuối cùng có thể sử dụng của mạng con VLAN nhất định) ## 18.36 # Kiểm tra Sub - interface:**Sub - interface sẽ xuất hiện với lệnh: ** ``` router# show IP interface brief ``` ![image](HTTPS: //github.com/psaumur/CCNA/assets/106411237/9b7ecbd1 - c5f4 - 4ed0 - 9988 - 8fd17e16c9ae) **Chúng cũng xuất hiện trong bảng định tuyến:** ``` router# show IP route ``` ![image](HTTPS: //github.com/psaumur/CCNA/assets/106411237/1e9bb3fa - 5aca - 4883 - 8aff - 52a554dcfba6) **Đặc điểm:** ## 18.37 TÓM TẮT ROAS **ROAS dùng để định tuyến giữa nhiều VLAN sử dụng một INTERFACE duy nhất trên router và switch** ## 18.38 # Cấu hình: - **switch Interface:** Cấu hình như trunk thông thường - **router Interface:** Cấu hình sử dụng SUB - INTERFACE • Cấu hình VLAN tag và địa chỉ IP trên MỖI SUB - Interface ## 18.39 # Hoạt động: - **router sẽ hoạt động** như thể các khung đến với VLAN tag nhất định đã đến trên SUB - Interface được cấu hình với VLAN tag đó - **router sẽ TAG các khung** được gửi ra từ MỖI SUB - Interface với VLAN TAG được cấu hình trên SUB - Interface ## 18.40 # Lệnh cấu hình cơ bản: ``` router(config)# interface g0/0.10 router(config - subif)# encapsulation dot1q 10 router(config - subif)# IP address 192.168.10.1 255.255.255.0 ```