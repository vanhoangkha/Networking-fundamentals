# 37. NTP WHY l√† TIME IMPORTANT cho M·∫°ng DEVICES? - All DEVICES have m·ªôt INTERNAL CLOCK (ROUTERS, SWITCHES, PCs, etc) - In CISCO IOS, you c√≥ th·ªÉ view the time v·ªõi the `show clock` L·ªánh ![image](https://github.com/psaumur/CCNA/assets/106411237/0afc355a-a982-4caa-a470-e09070e9c74f) - If you use the `show clock detail` L·ªánh, you c√≥ th·ªÉ see the TIME SOURCE ![image](https://github.com/psaumur/CCNA/assets/106411237/a49cc147-ddba-405d-8e70-745ae7434e5a) - The INTERNAL HARDWARE CLOCK c·ªßa m·ªôt Thi·∫øt b·ªã will ‚Äúdrift‚Äô over time, so it‚Äôs NOT the ideal time source. - From m·ªôt CCNA perspective, the most important reason ƒë·∫øn have accurate time tr√™n m·ªôt Thi·∫øt b·ªã l√† ƒë·∫øn have ACCURATE logs cho Kh·∫Øc ph·ª•c s·ª± c·ªë - **Syslog**, the Giao th·ª©c used ƒë·∫øn keep Thi·∫øt b·ªã logs, will be covered trong m·ªôt later video L·ªánh: `show logging` ![image](https://github.com/psaumur/CCNA/assets/106411237/33632e20-a4e9-40fd-aba0-527498cfb886) Note : R3‚Äôs time stamp l√† completely different than R2‚Äôs !!! ![image](https://github.com/psaumur/CCNA/assets/106411237/7d0464c2-1abe-460a-93fb-dd4368c905a7) --- MANUAL TIME C·∫•u h√¨nh - You c√≥ th·ªÉ manually configure the TIME tr√™n the Thi·∫øt b·ªã v·ªõi the `clock set` L·ªánh ![image](https://github.com/psaumur/CCNA/assets/106411237/fa5d40c2-bccb-48e2-9f6b-c85ad721f37f) - Although the HARDWARE CALENDAR (built-in clock) is the Default time-source, the HARDWARE CLOCK v√† SOFTWARE CLOCK l√† separate v√† c√≥ th·ªÉ be configured separately. --- HARDWARE CLOCK (CALENDAR) C·∫•u h√¨nh - You c√≥ th·ªÉ MANUALLY configure the HARDWARE CLOCK v·ªõi the `calendar set` L·ªánh ![image](https://github.com/psaumur/CCNA/assets/106411237/b72c898a-4746-49de-86db-c519964b3916) - Typically, you s·∫Ω want ƒë·∫øn SYNCHRONIZE the ‚Äòclock‚Äô and ‚Äòcalendar‚Äô - Use the L·ªánh `clock update-calendar` ƒë·∫øn sync the calendar ƒë·∫øn the clock‚Äôs time - Use the L·ªánh `clock read-calendar` ƒë·∫øn sync the clock ƒë·∫øn the calendar‚Äôs time ![image](https://github.com/psaumur/CCNA/assets/106411237/c9d24bfd-25b1-4c5d-a426-f2a8a2db108c) ![image](https://github.com/psaumur/CCNA/assets/106411237/104a5e27-0d5f-40fc-aea8-dbcf46c3e195) --- CONFIGURING THE TIME ZONE - You c√≥ th·ªÉ configure the time zone v·ªõi the `clock timezone` L·ªánh ![image](https://github.com/psaumur/CCNA/assets/106411237/d9ef5a95-a102-4306-bc3d-269fc5fd1d9e) DAYLIGHT SAVING TIME (SUMMER TIME) ![image](https://github.com/psaumur/CCNA/assets/106411237/591491d1-a5bd-4f99-b518-02e722f41e1a) ![image](https://github.com/psaumur/CCNA/assets/106411237/3319f4c0-fb72-4486-b14c-4648c2be7338) Full L·ªánh : `R1(config)# clock summer-time EDT recurring 2 Sunday March 02:00 1 Sunday November 02:00` This covers the START c·ªßa Daylight Savings v√† the end c·ªßa Daylight Savings --- SUMMARY c·ªßa COMMANDS ![image](https://github.com/psaumur/CCNA/assets/106411237/33557221-c045-4063-8ca0-9e8fb045ce52) --- NTP BASICS - Manually configuring the time tr√™n DEVICES l√† NOT Scalable - The manually configured clocks will ‚Äúdrift‚Äù, resulting trong inaccurate time - NTP (M·∫°ng Time Giao th·ª©c) allows AUTOMATIC synchronization c·ªßa TIME over m·ªôt M·∫°ng - NTP CLIENTS request the TIME t·ª´ NTP SERVERS - A Thi·∫øt b·ªã c√≥ th·ªÉ be m·ªôt NTP SERVER v√† m·ªôt NTP CLIENT t·∫°i the same time - NTP allows accuracy c·ªßa TIME with ~1 millisecond if the NTP SERVER l√† trong the same LAN - OR within ~50 milliseconds if connecting ƒë·∫øn the NTP SERVER over m·ªôt WAN / the Internet - Some NTP SERVERS are ‚Äòbetter‚Äô than others. The ‚Äòdistance‚Äô of m·ªôt NTP SERVER t·ª´ the original **reference clock** is called **stratum** <aside> üí° NTP uses UDP C·ªïng 123 ƒë·∫øn communicate </aside> REFERENCE CLOCK - A REFERENCE CLOCK l√† usually m·ªôt VERY accurate time Thi·∫øt b·ªã like m·ªôt ATOMIC CLOCK ho·∫∑c GPS CLOCK - REFERENCE CLOCKS are **stratum 0** within the NTP hierarchy - NTP SERVERS directly connected ƒë·∫øn REFERENCE CLOCKS are **stratum 1** ![image](https://github.com/psaumur/CCNA/assets/106411237/003bf28a-03fe-49a8-954c-728f8e79dbd9) (Peering v·ªõi Devices l√† called ‚Ä¶) ![image](https://github.com/psaumur/CCNA/assets/106411237/e2b91988-9be4-419b-b0b3-ad4ac32ae5cc) - An NTP CLIENT c√≥ th·ªÉ SYNC ƒë·∫øn MULTIPLE NTP SERVERS ![image](https://github.com/psaumur/CCNA/assets/106411237/32146173-fa80-4926-9524-ad66de3f9a6b) --- NTP C·∫•u h√¨nh ![image](https://github.com/psaumur/CCNA/assets/106411237/6ee32d55-a33d-419c-9286-d1683f250d37) ![image](https://github.com/psaumur/CCNA/assets/106411237/453bd559-d88f-46c8-b4c9-cea958ef216d) ![image](https://github.com/psaumur/CCNA/assets/106411237/6adb6092-0290-4ae9-961d-55d25ec1d3c7) Using key argument ‚Äúprefer‚Äù makes m·ªôt given server the PREFERRED SERVER (To show C·∫•u h√¨nh servers) ![image](https://github.com/psaumur/CCNA/assets/106411237/aabee138-5cb3-4316-8411-8da38d6dd2d5) `sys.peer` = This l√† the SERVER that the current Router (R1) is being synchronized to `st` = Stratum Tier (To show NTP Status) ![image](https://github.com/psaumur/CCNA/assets/106411237/4501f436-3e52-48c4-b22c-a733547b8b98) `stratum 2` because it‚Äôs synchronizing t·ª´ Google (stratum 1) (To show NTP clock details) ![image](https://github.com/psaumur/CCNA/assets/106411237/bde14525-17e6-4d63-9d0b-b992c3dd7725) This L·ªánh configures the Router ƒë·∫øn update the HARDWARE CLOCK (Calendar) with the time learned via NTP `R1(config)# ntp update-calendar` The HARDWARE CLOCK tracks the DATE v√† TIME tr√™n the Thi·∫øt b·ªã - even if it restarts, power l√† lost, etc. When the SYSTEM l√† restarted, the HARDWARE CLOCK l√† used ƒë·∫øn INITIALIZE the SOFTWARE CLOCK --- CONFIGURE m·ªôt LOOPBACK Giao di·ªán cho m·ªôt NTP SERVER ![image](https://github.com/psaumur/CCNA/assets/106411237/21cac8d8-7c7f-41e1-8f0a-bfb6418c6085) Why configure m·ªôt LOOPBACK Thi·∫øt b·ªã tr√™n R1 cho NTP ? If one c·ªßa R1‚Äôs Router INTERFACES goes down, it s·∫Ω still be accessible via R3‚Äôs ƒê·ªãnh tuy·∫øn path ![image](https://github.com/psaumur/CCNA/assets/106411237/9ead84f6-8645-489c-a30d-0b3c7ebf6ba1) SET NTP SERVER cho R2 using the LOOPBACK Giao di·ªán tr√™n R1 ![image](https://github.com/psaumur/CCNA/assets/106411237/8a05e16e-cab9-429c-836e-e74a1007cbcb) SETTING R3 NTP SOURCE SERVERS using R1 v√† R2 ![image](https://github.com/psaumur/CCNA/assets/106411237/bcbd2426-1745-437a-9ebd-fe80dce6b527) NOTE : R1 has PREFERENCE because it‚Äôs STRATUM TIER l√† HIGHER than R2s --- CONFIGURING NTP SERVER MODE ![image](https://github.com/psaumur/CCNA/assets/106411237/038c5e31-587e-4a54-ae80-cc290a0ff805) ![image](https://github.com/psaumur/CCNA/assets/106411237/903a6aba-e99d-4ee6-a9c5-e077eed0592a) ![image](https://github.com/psaumur/CCNA/assets/106411237/0b5928d9-6594-4f3d-8663-8f4f19d3245b) ![image](https://github.com/psaumur/CCNA/assets/106411237/0aad6e81-5b7b-41ad-82b1-6c98690a9a4c) ![image](https://github.com/psaumur/CCNA/assets/106411237/e68f0ab9-25f5-4e65-8e80-f07b15878f69) --- CONFIGURING NTP SYMMETRIC ACTIVE MODE L·ªánh ƒë·∫øn configure NTP SYMMETRIC MODE `R2(config)#ntp peer <peer ip address>` ![image](https://github.com/psaumur/CCNA/assets/106411237/a0c27863-86d7-40e4-a935-6c73fce39439) ![image](https://github.com/psaumur/CCNA/assets/106411237/d430e372-8480-4378-92e4-5e5ca06f2ac1) --- CONFIGURE NTP X√°c th·ª±c - NTP X√°c th·ª±c c√≥ th·ªÉ be configured, although it l√† OPTIONAL - It allows NTP CLIENTS ƒë·∫øn ensure they only sync ƒë·∫øn the intended SERVERS - To CONFIGURE NTP X√°c th·ª±c: - `ntp authenticate` (Enables NTP X√°c th·ª±c) - `ntp authenticate-key *key-number* md5 *key*` (Create the NTP X√°c th·ª±c Key(s)) - `ntp trusted-key *key-number`* (Specify the Trusted Key(s)) - `ntp server *ip-address* key *key-number`* (Specify which key ƒë·∫øn use cho the server) EXAMPLE CONFIGURATIONS ![image](https://github.com/psaumur/CCNA/assets/106411237/d8f54d79-8975-4dfe-b0c0-e4e2b44f7b31) --- NTP L·ªánh REVIEW ![image](https://github.com/psaumur/CCNA/assets/106411237/2888ef4e-f53a-4ca3-ad34-0b04742edfd9) 